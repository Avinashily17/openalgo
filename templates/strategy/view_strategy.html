{% extends "base.html" %}

{% block content %}
<div class="container mx-auto px-4 py-8">
    <!-- Strategy Header -->
    <div class="flex justify-between items-center mb-6">
        <div class="flex items-center gap-4">
            <h1 class="text-2xl font-bold">{{ strategy.name }}</h1>
            <form action="{{ url_for('strategy_bp.toggle_strategy_route', strategy_id=strategy.id) }}" 
                  method="POST" class="inline">
                <button type="submit" class="btn {% if strategy.is_active %}btn-error{% else %}btn-success{% endif %}">
                    {% if strategy.is_active %}Deactivate{% else %}Activate{% endif %}
                </button>
            </form>
            <a href="{{ url_for('strategy_bp.configure_symbols', strategy_id=strategy.id) }}" 
               class="btn btn-ghost">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2" viewBox="0 0 20 20" fill="currentColor">
                    <path fill-rule="evenodd" d="M11.49 3.17c-.38-1.56-2.6-1.56-2.98 0a1.532 1.532 0 01-2.286.948c-1.372-.836-2.942.734-2.106 2.106.54.886.061 2.042-.947 2.287-1.561.379-1.561 2.6 0 2.978a1.532 1.532 0 01.947 2.287c-.836 1.372.734 2.942 2.106 2.106a1.532 1.532 0 012.287.947c.379 1.561 2.6 1.561 2.978 0a1.533 1.533 0 012.287-.947c1.372.836 2.942-.734 2.106-2.106a1.533 1.533 0 01.947-2.287c1.561-.379 1.561-2.6 0-2.978a1.532 1.532 0 01-.947-2.287c.836-1.372-.734-2.942-2.106-2.106a1.532 1.532 0 01-2.287-.947zM10 13a3 3 0 100-6 3 3 0 000 6z" clip-rule="evenodd" />
                </svg>
                Configure
            </a>
        </div>
    </div>

    <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
        <!-- Left Column -->
        <div class="space-y-6">
            <!-- Strategy Details -->
            <div class="card bg-base-100 shadow-xl">
                <div class="card-body">
                    <h2 class="card-title">Strategy Details</h2>
                    <div class="grid grid-cols-2 gap-4">
                        <div>
                            <label class="text-sm opacity-70">Platform</label>
                            <p class="font-semibold">{{ strategy.platform }}</p>
                        </div>
                        <div>
                            <label class="text-sm opacity-70">Mode</label>
                            <p class="font-semibold">{{ strategy.mode }}</p>
                        </div>
                        <div>
                            <label class="text-sm opacity-70">Type</label>
                            <p class="font-semibold">{{ 'Delivery' if not strategy.is_intraday else 'Intraday' }}</p>
                        </div>
                        <div>
                            <label class="text-sm opacity-70">Status</label>
                            <div class="badge {% if strategy.is_active %}badge-success{% else %}badge-error{% endif %}">
                                {{ 'Active' if strategy.is_active else 'Inactive' }}
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Webhook Details -->
            <div class="card bg-base-100 shadow-xl">
                <div class="card-body">
                    <h2 class="card-title">Webhook Details</h2>
                    <div class="space-y-4">
                        <div class="form-control">
                            <div class="input-group">
                                <input type="text" class="input input-bordered flex-1" value="{{ webhook_url }}" id="webhookUrl" readonly />
                                <button class="btn" onclick="copyWebhookUrl()">
                                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor">
                                        <path d="M8 3a1 1 0 011-1h2a1 1 0 110 2H9a1 1 0 01-1-1z" />
                                        <path d="M6 3a2 2 0 00-2 2v11a2 2 0 002 2h8a2 2 0 002-2V5a2 2 0 00-2-2 3 3 0 01-3 3H9a3 3 0 01-3-3z" />
                                    </svg>
                                </button>
                            </div>
                        </div>
                        <div class="mockup-code bg-neutral text-neutral-content">
                            <pre><code>{
    "Strategy": "{{ strategy.name }}",
    "symbol": "SYMBOL",
    "exchange": "EXCHANGE",
    "action": "BUY/SELL",
    "quantity": "QUANTITY"
}</code></pre>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Right Column -->
        <div class="space-y-6">
            <!-- Trading Rules -->
            <div class="card bg-base-100 shadow-xl">
                <div class="card-body">
                    <h2 class="card-title">Trading Rules</h2>
                    <div class="space-y-4">
                        <p class="font-semibold">Mode: {{ strategy.mode }}</p>
                        <div class="space-y-2">
                            {% if strategy.mode in ['LONG', 'BOTH'] %}
                            <div class="flex items-center text-success gap-2">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor">
                                    <path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd" />
                                </svg>
                                <span>Accepts BUY and SELL orders</span>
                            </div>
                            {% endif %}
                            {% if strategy.mode not in ['LONG', 'BOTH'] %}
                            <div class="flex items-center text-error gap-2">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor">
                                    <path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd" />
                                </svg>
                                <span>Does not accept SHORT and COVER orders</span>
                            </div>
                            {% endif %}
                        </div>
                    </div>
                </div>
            </div>

            <!-- Configured Symbols -->
            <div class="card bg-base-100 shadow-xl">
                <div class="card-body">
                    <h2 class="card-title">Configured Symbols</h2>
                    {% if symbol_mappings %}
                    <div class="overflow-x-auto">
                        <table class="table table-zebra w-full">
                            <thead>
                                <tr>
                                    <th>Symbol</th>
                                    <th>Exchange</th>
                                    <th>Quantity</th>
                                    <th>Product</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for mapping in symbol_mappings %}
                                <tr>
                                    <td>{{ mapping.symbol }}</td>
                                    <td>
                                        <div class="badge badge-ghost">{{ mapping.exchange }}</div>
                                    </td>
                                    <td>{{ mapping.quantity }}</td>
                                    <td>
                                        <div class="badge {% if mapping.product_type == 'MIS' %}badge-warning{% else %}badge-info{% endif %}">
                                            {{ mapping.product_type }}
                                        </div>
                                    </td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                    {% else %}
                    <div class="alert alert-info">
                        <div>
                            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" class="stroke-current shrink-0 w-6 h-6"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg>
                            <span>No symbols configured yet. Click Configure to add symbols.</span>
                        </div>
                    </div>
                    {% endif %}
                </div>
            </div>
        </div>
    </div>
</div>

{% block scripts %}
<script>
function copyWebhookUrl() {
    const webhookUrl = document.getElementById('webhookUrl');
    webhookUrl.select();
    document.execCommand('copy');
    
    // Show toast notification
    const toast = document.createElement('div');
    toast.className = 'alert alert-success fixed bottom-4 right-4 w-auto max-w-sm z-50';
    toast.innerHTML = `
        <span>Webhook URL copied to clipboard!</span>
        <button class="btn btn-ghost btn-xs" onclick="this.parentElement.remove()">Ã—</button>
    `;
    document.body.appendChild(toast);
    setTimeout(() => toast.remove(), 3000);
}
</script>
{% endblock %}
{% endblock %}
